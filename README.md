# cli

完备的脚手架可以快速搭建和启动常规项目

![cli](../assets/images/cli_structure.png.png)

## 需求

一个完整的构建工具架构需要满足一些核心需求

1. 交互明确的命令行界面
2. 模板分离
3. 多种配置及插件扩展
4. 本地开发环境
5. 自动化测试/部署

## 目的

搭建脚手架目的主要是为了解决一下目的

1. 减少重复性工作
2. 规范项目结构
3. 统一开发风格及规范
4. 快速启动项目，专注业务

## 架构

主流脚手架常规流程为

1. 根据需求生成配置文件
2. 下载指定模板
3. 生成项目结构
4. 本地开发环境启动
5. 热更新
6. 代码规范检测

在常规需求中再附加业务常见需求进行定制搭建即可

## 主要依赖

1. babel-cli/babel-env：语法转换工具，脚手架开发中使用 ES6 语法
2. commander：命令行工具，读取命令行命令
3. inquirer：交互式命令行工具，给用户提供一个漂亮的界面和提出问题流的方式
4. download-git-repo：下载远程模板工具，负责下载远程仓库的模板项目
5. chalk：颜色插件，用来修改命令行输出样式，通过颜色区分 info、error 日志，清晰直观
6. ora：用于显示加载中的效果，类似于前端页面的 loading 效果，像下载模板这种耗时的操作，有了 loading 效果可以提示用户正在进行中，请耐心等待
7. log-symbols：日志彩色符号，用来显示 √ 或 × 等的图标

## 项目模板

脚手架需要准备几套常用的项目结构配置，在创建项目时，直接拉取对应的模板再进行部分配置的修改即可

模板最好存放在一个远端仓库，通过动态地址进行获取下载，这样解耦脚手架和模板，方便更新维护

## 搭建

![cli](../assets/images/cli_flow.png.png)

1. 执行`npm init`初始化项目
2. 修改`package.json`中的`bin`参数，放置用户自定义命令
3. 修改`package.json`中的`script`参数，指定执行命令
4. 配置`.babelrc`文件，支持`ES6`转义
5. 安装主要依赖

## 配置 cli 命令

发布的脚手架全局安装后可以直接使用`cli`
为了开发过程中的调试，需要将 CLI 命令链接到全局
可以在项目目录下执行`npm link`，该命令可以将项目下的 `bin` 命令软链接到全局，直接使用。

## 处理命令行

通过 `commander` 设置不同的命令动作，[commander](https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md)

- `command`： 方法设置命令名字
- `description`： 设置命令描述
- `alias`： 设置命令简称
- `option`： 设置命令需要的参数
- `action`： 设置命令钩子

首先设置项目创建

## 项目创建

项目创建步骤：

1. 输入新建项目名称
2. 判断当前路径是否有相同目录
3. 引导用户配置信息
4. 下载模板
5. 下载完成，根据用户输入更新配置文件

## 项目初始化

项目初始化步骤：

1. 安装依赖
2. 初始化 `git` 仓库


## 项目启动

利用模板 `webpack-cli-server` 配置，启动本地开发环境